---
import Blocks from "@/components/Blocks.astro";
import usePage from "@/hooks/usePage";
import Layout from "@/layouts/Layout.astro";
import { getBlockNames } from "@/utils/parsing";

export async function getStaticPaths() {
  const { fetchAllPages } = await usePage();
  const { pages } = await fetchAllPages();
  return pages.flatMap((page) => {
    if (page.slug === "home") return [];
    return {
      params: {
        page: page.slug,
      },
      props: {
        documentId: page.documentId,
      },
    };
  });
}
const { page } = Astro.params;
const { documentId } = Astro.props;
const { fetchPageByDocId, fetchAllPages } = await usePage();
const { defaultLocale } = await fetchAllPages();
const blocks = await fetchPageByDocId(documentId, page);
---

<Layout>
  <Blocks block={blocks} blockNames={getBlockNames(blocks, defaultLocale)} />
</Layout>
