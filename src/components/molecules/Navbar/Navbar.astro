---
import Button from "@/components/atoms/Button/Button";
import ToggleLang from "@/components/molecules/ToggleLang";
import ToggleTheme from "@/components/molecules/ToggleTheme";
import usePage from "@/hooks/usePage";
import { type PageType } from "@/types/pages";
import Typography from "@/components/atoms/Typography";
import DinamicIcon from "@/components/atoms/DinamicIcon";
const { fetchAllPages } = await usePage();
const { pages } = await fetchAllPages();
//Aca se iteran todas las paginas creadas en el CMS como links para el NavBar
---

<section
  class="self-center w-[90%] xl:w-full bg-white dark:bg-black/45 backdrop-blur py-4 rounded-b-[30px] shadow-lg dark:shadow-[0_1px_35px_5px_rgba(115,236,140,0.7)]"
>
  {
    pages.length > 0 ? (
      <div class="w-full flex flex-row justify-between px-5">
        <ToggleTheme client:load />
        {pages.map((page: PageType) => {
          return (
            <a href={`/${page.slug === "home" ? "" : page.slug}`}>
              <Button
                variant="link"
                className="dark:text-white dark:hover:text-light-200 gap-2"
                client:load
              >
                <DinamicIcon
                  iconname={page.phosphorIcon}
                  className="size-5"
                  weight="bold"
                />
                {page.name}
              </Button>
            </a>
          );
        })}
        <ToggleLang client:only="react" />
      </div>
    ) : (
      <div class="relative flex py-2">
        <ToggleTheme
          className="absolute right-4 top-4 -translate-y-1/2"
          client:load
        />
        <Typography className="w-full text-center self-center">
          No pages found
        </Typography>
      </div>
    )
  }
</section>
<script>
  //Dark mode toggle
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("toggle-theme");
    const html = document.documentElement;

    //First theme check && keep default theme
    const isFirstTheme = localStorage.getItem("theme");
    console.log("isFirstTheme", isFirstTheme);
    if (isFirstTheme === null) {
      const isDarkTheme = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      console.log("isDarkTheme", isDarkTheme);
      if (!isDarkTheme) {
        localStorage.setItem("theme", "light");
      }
      if (isDarkTheme) {
        localStorage.setItem("theme", "dark");
        html.classList.add("dark");
      }
    }

    // Aplicar tema guardado si existe
    if (localStorage.getItem("theme") === "dark") {
      html.classList.add("dark");
    }

    //Toggle listener
    btn?.addEventListener("click", () => {
      const isDark = html.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  });
</script>
